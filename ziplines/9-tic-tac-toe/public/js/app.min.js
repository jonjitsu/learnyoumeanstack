"use strict";var d=console.log.bind(console),EMPTY_CELL_VALUE=null,BOARD_SIZE=3,cell=function(r,n){return{value:r||EMPTY_CELL_VALUE,isWinner:n||!1,reset:function(){this.value=r||EMPTY_CELL_VALUE,this.isWinner=n||!1}}},checkForWinBruteForce=function(r){var n=[[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[6,4,2]],t=function(n){var t,e=r[n[0]];if(e===EMPTY_CELL_VALUE)return!1;for(t=1;t<n.length;t++)if(r[n[t]]!==e)return!1;return!0},e=n.filter(t);return e.length>0?{winner:r[e[0][0]],line:e[0]}:!1},board=function(r,n){var t=function(r,n){var t,e=[];for(t=0;r*r>t;t++)e[t]=cell(n);return e},e=function(r){return r.map(function(r){return r.value})},i=t(r,n),o={get:function(n,t){return this.state[n*r+t]},state:i,asArray:e.bind(null,i),isGameOver:!1,nextMark:"X",checkForWin:function(){return checkForWinBruteForce(this.asArray())},checkForDraw:function(r){var n;for(n=0;n<r.length;n++)if(r[n].value===EMPTY_CELL_VALUE)return!1;return!0},isValidMove:function(r,n){var t=void 0===n?this.state[r]:this.get(r,n);return t.value===EMPTY_CELL_VALUE},playMove:function(r,n){var t=void 0===n?this.state[r]:this.get(r,n);if(!this.isGameOver&&t.value===EMPTY_CELL_VALUE){t.value=this.nextMark,this.nextMark="X"===this.nextMark?"O":"X";var e=!1;(e=this.checkForWin())?(this.isGameOver=!0,this.setWinner(e.winner,e.line)):this.checkForDraw(i)&&(this.isGameOver=!0)}},setWinner:function(r,n){this.winner=r,n.forEach(function(r){this.state[r].isWinner=!0},this)},reset:function(){for(var r=0;r<this.state.length;r++)this.state[r].reset();this.isGameOver=!1,this.nextMark="X"}};return o},AIs={dumb:function(r){var n;for(n=0;n<r.length;n++)if(r[n].value===EMPTY_CELL_VALUE)return n;return null},wikipedia:function(r,n){var t=function(r){return"X"===r?"O":"X"},e=function(r,n){var t,e=0;for(t=0;t<r.length;t++)r[t]===EMPTY_CELL_VALUE&&(r[t]=n,checkForWinBruteForce(r)&&e++,r[t]=EMPTY_CELL_VALUE);return e},i=function(r,n){return e(r,n)>1},o=function(n){var t,e;for(t=0;t<r.length;t++)if(r[t]===EMPTY_CELL_VALUE&&void 0!==(e=n(t,r.slice())))return e;return!1},u=function(r,n){return r[1]===EMPTY_CELL_VALUE?1:r[3]===EMPTY_CELL_VALUE?3:r[5]===EMPTY_CELL_VALUE?5:r[7]===EMPTY_CELL_VALUE?7:void 0},a=function(r){for(var n=0;n<r.length;n++)if(r[n]===EMPTY_CELL_VALUE)return n;return!1},s=function(r,n){for(var t=0;t<r.length;t++)if(r[t]===EMPTY_CELL_VALUE){if(r[t]=n,checkForWinBruteForce(r))return t;r[t]=EMPTY_CELL_VALUE}return!1},c=function(r,n){return s(r,t(n))},E=function(r,n){return o(function(r,t){return t[r]=n,i(t,n)?r:void 0})},h=function(r,n){var e=E(r,t(n));return e?r[4]===n?u(r,n):e:!1},l=function(r,n){return r[4]===EMPTY_CELL_VALUE?4:!1},L=function(r,n){var e=t(n);return r[0]===e&&r[8]===EMPTY_CELL_VALUE?8:r[8]===e&&r[0]===EMPTY_CELL_VALUE?0:r[2]===e&&r[6]===EMPTY_CELL_VALUE?6:r[6]===e&&r[2]===EMPTY_CELL_VALUE?2:!1},f=function(r,n){var t=function(r){return r[0]===EMPTY_CELL_VALUE&&r[2]===EMPTY_CELL_VALUE&&r[6]===EMPTY_CELL_VALUE&&r[8]===EMPTY_CELL_VALUE};return t(r)?0:!1},_=[s,c,E,h,l,L,f,u,a],v=function(r,n,t){var e,i;for(e=0;e<r.length;e++)if((i=r[e](n.slice(),t))!==!1)return d("Strat: "+e),i;throw new Error("Should not be here.")};return v(_,r,n)}},PLAYER={HUMAN:1,COMPUTER:2};angular.module("ticTacToe",[]).filter("range",function(){return function(r){for(var n=[],t=0;r>t;t++)n.push(t);return n}}).controller("GameController",[function(){var r=this;r.xplayer=!1,r.isRunning=!1,r.selectPlayer=function(r){d(r),this.xplayer=r,this.isRunning=!0},r.handleWin=function(r){d("won: ",r),this.winner=r,this.isRunning=!1}}]).directive("gameBoard",[function(){var r=[function(){var r=AIs.wikipedia,n=function(r){return parseInt(r,10)===PLAYER.COMPUTER};d("construct",this),this.readyToStart=!1,this.board=board(BOARD_SIZE,EMPTY_CELL_VALUE),this.computerMove=function(){var n=r(this.board.asArray(),this.board.nextMark);this.board.playMove(n)},this.resetBoard=function(){d("Reset game"),this.board.reset(),n(this.xplayer)&&this.computerMove(),this.isRunning=!0},this.mark=function(r,n){if(d("this:",this),d(this.board.get(r,n)),this.board.isGameOver)this.resetBoard();else{if(!this.board.isValidMove(r,n))return;this.board.playMove(r,n),this.board.isGameOver||this.computerMove()}this.board.isGameOver&&null!==this.board.winner&&(d("Won!"),this.onWon({player:this.board.winner}))}}];return{restrict:"E",templateUrl:"gameboard.html",controller:r,controllerAs:"c",scope:{xplayer:"@",isRunning:"=",onWon:"&"},bindToController:!0,link:function(r){r.$watch("c.isRunning",function(n,t){d(arguments),n===!0&&t===!1&&r.c.resetBoard()}),r.$watch("c.xplayer",function(){})}}}]).directive("playerChooser",[function(){var r=[function(){this.HUMAN=PLAYER.HUMAN,this.COMPUTER=PLAYER.COMPUTER,this.handleSelection=function(r){d(r),this.fireSelect({xplayer:r})}}];return{restrict:"E",templateUrl:"player-chooser.html",controller:r,controllerAs:"pcc",scope:{fireSelect:"&onSelectXplayer"},bindToController:!0}}]);
//# sourceMappingURL=app.min.js.map
