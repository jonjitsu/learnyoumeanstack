"use strict";var d=console.log.bind(console),EMPTY_CELL_VALUE=null,BOARD_SIZE=3,cell=function(r,n){return{value:r||EMPTY_CELL_VALUE,isWinner:n||!1,reset:function(){this.value=r||EMPTY_CELL_VALUE,this.isWinner=n||!1}}},checkForWin=function(r,n){var e=function(r){var n=function(n,e){return n*r+e},e=function(r){var e,t,i,o=[];for(i=0;r>i;i++){for(e=[],t=0;r>t;t++)e.push(n(i,t));o.push(e)}return o},t=function(r){var e,t,i,o=[];for(t=0;r>t;t++){for(e=[],i=0;r>i;i++)e.push(n(t,i));o.push(e)}return o},i=function(r){var e=[],t=[],i=[],o=0,u=0;do t.push(n(o,u)),i.push(n(r-o,u)),u++,o++;while(r>u);return e};return e(r).concat(t(r)).concat(i(r))};return e(n)},checkForWinBruteForce=function(r){var n=function(){var n,e,t,i;for(n=0;n<r.length;n++)if(t=r[n][0].value,t!==EMPTY_CELL_VALUE){for(i=[[n,0]],e=1;e<r[n].length;e++){if(r[n][e].value!==t){i=null;break}i.push([n,e])}if(null!==i)return{winner:t,line:i}}return!1},e=function(){var n,e,t,i;for(e=0;e<r[0].length;e++)if(t=r[0][e].value,t!==EMPTY_CELL_VALUE){for(i=[[0,e]],n=1;n<r.length;n++){if(r[n][e].value!==t){i=null;break}i.push([n,e])}if(null!==i)return{winner:t,line:i}}return!1},t=function(){var n,e=1,t=1,i=r[0][0].value;if(i!==EMPTY_CELL_VALUE){for(n=[[0,0]];e<r.length&&t<r[e].length;){if(i!==r[e][t].value){n=null;break}n.push([e,t]),t++,e++}if(null!==n)return{winner:i,line:n}}if(t=1,e=r.length-1,i=r[e][0].value,n=[[e,0]],e--,i!==EMPTY_CELL_VALUE){for(;e>=0&&t<r[e].length;){if(i!==r[e][t].value){n=null;break}n.push([e,t]),t++,e--}if(null!==n)return{winner:i,line:n}}return!1},i=!1;return(i=n())||(i=e())||(i=t())?i:!1},board=function(r,n){var e=function(r,n){var e,t=[];for(e=0;r*r>e;e++)t[e]=cell(n);return t},t=function(n){for(var e=[],t=[],i=0;i<n.length;i++)t.push(n[i]),i%r===r-1&&(e.push(t),t=[]);return e},i=e(r,n),o=t(i),u={get:function(n,e){return this.state[n*r+e]},state:i,isGameOver:!1,nextMark:"X",checkForWin:checkForWinBruteForce.bind(u,o),checkForDraw:function(r){var n;for(n=0;n<r.length;n++)if(r[n].value===EMPTY_CELL_VALUE)return!1;return!0},isValidMove:function(r,n){var e=void 0===n?this.state[r]:this.get(r,n);return e.value===EMPTY_CELL_VALUE},playMove:function(r,n){var e=void 0===n?this.state[r]:this.get(r,n);if(!this.isGameOver&&e.value===EMPTY_CELL_VALUE){e.value=this.nextMark,this.nextMark="X"===this.nextMark?"O":"X";var t=!1;(t=this.checkForWin())?(this.isGameOver=!0,this.setWinner(t.winner,t.line)):this.checkForDraw(i)&&(this.isGameOver=!0)}},grid:o,setWinner:function(r,n){this.winner=r,n.forEach(function(r){var n,e;e=r[0],n=r[1],this.get(e,n).isWinner=!0},this)},reset:function(){for(var r=0;r<this.state.length;r++)this.state[r].reset();this.isGameOver=!1,this.nextMark="X"}};return u},AIs={dumb:function(r){var n;for(n=0;n<r.length;n++)if(r[n].value===EMPTY_CELL_VALUE)return n;return null},wikipedia:function(r,n){var e=(r.slice(),function(r,n){for(var e=0;e<r.length;e++)if(r[e].value===EMPTY_CELL_VALUE&&(r[e]=n,checkForWinBruteForce(r)))return e;return!1}),t=function(r){for(var n=0;n<r.length;n++)if(r[n].value===EMPTY_CELL_VALUE)return n;return!1},i=[e,t],o=function(r,n,e){var t,i;for(t=0;t<r.length;t++)if(i=r[t](n.slice(),e))return i;throw new Error("Should not get here.")};return o(i,r,n)}},PLAYER={HUMAN:1,COMPUTER:2};angular.module("ticTacToe",[]).filter("range",function(){return function(r){for(var n=[],e=0;r>e;e++)n.push(e);return n}}).controller("GameController",[function(){var r=this;r.xplayer=!1,r.isRunning=!1,r.selectPlayer=function(r){d(r),this.xplayer=r,this.isRunning=!0},r.handleWin=function(r){d("won: ",r),this.winner=r,this.isRunning=!1}}]).directive("gameBoard",[function(){var r=[function(){var r=AIs.dumb,n=function(r){return parseInt(r,10)===PLAYER.COMPUTER};d("construct",this),this.readyToStart=!1,this.board=board(BOARD_SIZE,EMPTY_CELL_VALUE),this.computerMove=function(){var n=r(this.board.state,this.board.nextMark);this.board.playMove(n)},this.resetBoard=function(){d("Reset game"),this.board.reset(),n(this.xplayer)&&this.computerMove(),this.isRunning=!0},this.mark=function(r,n){if(d("this:",this),d(this.board.get(r,n)),this.board.isGameOver)this.resetBoard();else{if(!this.board.isValidMove(r,n))return;this.board.playMove(r,n),this.board.isGameOver||this.computerMove()}this.board.isGameOver&&null!==this.board.winner&&(d("Won!"),this.onWon({player:this.board.winner}))}}];return{restrict:"E",templateUrl:"gameboard.html",controller:r,controllerAs:"c",scope:{xplayer:"@",isRunning:"=",onWon:"&"},bindToController:!0,link:function(r){r.$watch("c.isRunning",function(n,e){d(arguments),n===!0&&e===!1&&r.c.resetBoard()}),r.$watch("c.xplayer",function(){})}}}]).directive("playerChooser",[function(){var r=[function(){this.HUMAN=PLAYER.HUMAN,this.COMPUTER=PLAYER.COMPUTER,this.handleSelection=function(r){d(r),this.fireSelect({xplayer:r})}}];return{restrict:"E",templateUrl:"player-chooser.html",controller:r,controllerAs:"pcc",scope:{fireSelect:"&onSelectXplayer"},bindToController:!0}}]);
//# sourceMappingURL=app.min.js.map
