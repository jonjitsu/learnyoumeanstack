"use strict";function IdleTimer(){var t=1e3,n=function(t){void 0!==t&&(this._ms=t),this._id=setTimeout(this._fn,this._ms)},e=function(){clearTimeout(this._id)},o=function(){this.stop(),this.go()},i=function(i,r){return r=r||t,{_ms:r,_fn:i,_id:void 0,go:n,stop:e,resetTime:o}};return i}function ColoredButtonDirective(t){return{restrict:"E",replace:!0,scope:!0,template:'<div class="sm-btn"><button ng-mousedown="buttonDown()" ng-mouseup="buttonUp()"  class="sm-btn"></button></div>',link:function(n,e,o){var i=n.color=o.color;n.colorIndex=t[i];e.addClass("sm-"+i)},controller:["$scope","SoundSystem","$element","Bus","$attrs",function(n,e,o,i,r){var s=n,u=r.color,c=t[u],a=!1,f=function(t){return function(){a&&t.apply(this,arguments)}},l=function(){e.start(c),o.addClass("sm-active")},d=function(){e.stop(c),o.removeClass("sm-active")};s.buttonDown=f(l),s.buttonUp=f(function(){d(),s.buttonPress(c)}),i.on("btn"+c+"press",l),i.on("btn"+c+"release",d),i.on("btns:disable",function(){a=!1}),i.on("btns:enable",function(){a=!0})}]}}function GameCtrl(t,n,e,o,i,r){var s,u=t,c=(n[0],function(t){i.fire("btns:disable"),e.youLose(function(){i.fire("btns:enable"),t()})}),a=function(){u.isStrict?c(b):f()},f=function(){s=o.copy(),c(y.bind(null,s))},l=5e3,d=700,p=300,m=r(a,l),v=!1,y=function(t,n){if(logSequence(t),m.stop(),t=t.slice(),!v){v=!0,i.fire("btns:disable");var e,o=t.shift();void 0!==o&&(i.fire("btn"+o+"press"),e=setInterval(function(){return i.fire("btn"+o+"release"),o=t.shift(),void 0===o?(clearInterval(e),v=!1,i.fire("btns:enable"),m.go(),void("function"==typeof n&&n())):void setTimeout(function(){i.fire("btn"+o+"press")},p)},d))}},b=function(){l=5e3,d=700,p=300,m=r(a,l),u.round=1,u.$apply(),m.stop(),s=o.init(),y(s)},h=function(){u.round>12?(d=300,p=150):u.round>8?(d=400,p=200):u.round>4&&(d=500,p=250)},S=function(){d=100,p=100,y([0,1,3,2,0,1,3,2,0,1,3,2,0,1,3,2,0,1,3,2,0,1,3,2],b)},g=function(){u.round++,u.$apply(),h(),m.stop(),s=o.next(),y(s)},O=function(t){return function(){return v?void 0:t.apply(this,arguments)}};u.buttonPress=O(function(t){m.resetTime(),setTimeout(function(){s.shift()===t?0===s.length&&(2===u.round?S():g()):a()},700)}),u.isOn=!1,u.onOff=O(function(){u.isOn=!u.isOn,m.stop(),u.isOn||(u.isStarted=!1,i.fire("btns:disable"))}),u.isStarted=!1,u.start=O(function(){u.isOn&&(u.isStarted=!0,setTimeout(b,100))}),u.isStrict=!1,u.strict=O(function(){u.isOn&&(u.isStrict=!u.isStrict)})}function GameBus(){var t={};return{_events:t,on:function(n,e){n in t||(t[n]=[]),t[n].push(e)},fire:function(){var n=[].slice.call(arguments),e=n.shift(),o=t[e];o&&o.forEach(function(t){t.apply(null,n)})}}}function SequenceFactory(){var t=function(t,n){return void 0===n&&(n=t,t=0),Math.round(Math.random()*(n-t))+t};return{current:[],next:function(){return this.current.push(t(0,3)),this.current.slice()},init:function(){return this.current=[],this.next(),this.current.slice()},copy:function(){return this.current.slice()}}}function SoundSystem(t){var n=[415,310,252,209],e=[164,440,277,329],o=n.map(t.generate.bind(t));e.map(t.generate.bind(t));return{start:function(t){o[t].start()},stop:function(t){o[t].stop()},play:function(t,n){o[t].play(n)},youLose:function(n){var e=t.generate(70);e.start(),setTimeout(function(){e.stop(),n()},1e3)},youWin:function(){},volume:function(t,n){o[t].volume(n)}}}function ToneService(){var t={getAudioContext:function(){return void 0===this._ac&&(this._ac=new AudioContext),this._ac},generate:function(t){var n=this.getAudioContext(),e=n.createOscillator(),o=n.createGain();return e.type="square",e.frequency.value=t,e.start(0),o.gain.value=.15,{_ac:n,_os:e,_gn:o,start:function(){e.connect(o),o.connect(n.destination)},stop:function(){e.disconnect()},play:function(t){t=t||300,this.start(),setTimeout(function(){this.stop()}.bind(this),t)},volume:function(t){this._gn.gain.value=t}}}};return t}var l=console.log.bind(console),COLORS={green:0,red:1,yellow:2,blue:3},toArray=Function.prototype.call.bind(Array.prototype.slice),s,e,colorsAsArray=function(){var t=[];for(var n in COLORS){var e=COLORS[n];t[e]=n}return t},colorIndexToColor=function(t){return colorsAsArray()[t]},logSequence=function(t){l(t.map(colorIndexToColor))};angular.module("simonApp",[]).constant("COLORS",COLORS).factory("ToneService",[ToneService]).factory("SoundSystem",["ToneService",SoundSystem]).factory("SequenceFactory",SequenceFactory).factory("Bus",GameBus).factory("IdleTimer",IdleTimer).controller("GameCtrl",["$scope","$element","SoundSystem","SequenceFactory","Bus","IdleTimer",GameCtrl]).directive("coloredButton",["COLORS",ColoredButtonDirective]);
//# sourceMappingURL=app.min.js.map
